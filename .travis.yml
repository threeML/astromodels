language: generic

jobs:
  include:
  - os: linux
    python: 2.7
    env: TRAVIS_PYTHON_VERSION=2.7 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: osx
    python: 2.7
    env: TRAVIS_PYTHON_VERSION=2.7 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: linux
    python: 2.7
    env: TRAVIS_PYTHON_VERSION=2.7 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: osx
    python: 2.7
    env: TRAVIS_PYTHON_VERSION=2.7 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: linux
    python: 3.5
    env: TRAVIS_PYTHON_VERSION=3.5 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: osx
    python: 3.5
    env: TRAVIS_PYTHON_VERSION=3.5 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: linux
    python: 3.6
    env: TRAVIS_PYTHON_VERSION=3.6 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: osx
    python: 3.6
    env: TRAVIS_PYTHON_VERSION=3.6 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: linux
    python: 3.7
    env: TRAVIS_PYTHON_VERSION=3.7 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: osx
    python: 3.7
    env: TRAVIS_PYTHON_VERSION=3.7 TEST_WITH_XSPEC=false CONDA_UPLOAD=false
  - os: linux
    python: 3.5
    env: TRAVIS_PYTHON_VERSION=3.5 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: osx
    python: 3.5
    env: TRAVIS_PYTHON_VERSION=3.5 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: linux
    python: 3.6
    env: TRAVIS_PYTHON_VERSION=3.6 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: osx
    python: 3.6
    env: TRAVIS_PYTHON_VERSION=3.6 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: linux
    python: 3.7
    env: TRAVIS_PYTHON_VERSION=3.7 TEST_WITH_XSPEC=true CONDA_UPLOAD=true
  - os: osx
    python: 3.7
    env: TRAVIS_PYTHON_VERSION=3.7 TEST_WITH_XSPEC=true CONDA_UPLOAD=true

before_install:
- |
  if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
    #docker pull condaforge/linux-anvil

    wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda install -y conda-build
    conda config --add channels conda-forge
  else

    # Install Miniconda
    wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda install -y conda-build
    conda config --add channels conda-forge

  fi
  
script:
- chmod u+x ci/build_and_test.sh
- |
  while sleep 500; do
     echo "====[ $SECONDS seconds still running ]===="
  done &
- "./ci/build_and_test.sh"

deploy:
  provider: pypi
  user: __token__
  password:
    secure: xt1ssO0gKwNp0qbidYzojxlokqiijPrTcauiAvabnhuFXtjojkHhDTS6eLynfZOEFmonWrrGUMLNtf7fAR7VWFapV4l76G+rtZH4gxJ5qZ4ZyWkJ0PgAJE7p5+fU426dAqly34CV6f5U1TIUwGvxRZIPOWGHHzrGJXTBqtzQviie189MD/UzqFhG7J5oAwKvTdrah5+1RPBhhIIS7bFhRve5dIpsPWHjV0AgRj8yE4JzqqjWbmhD+HrfExbV9jfxj4lt/diYP7Mof5ChczUFppUAFdlyA6+6tZ235g4h8/sq+kQKcp4HJriFjxknusOp+3XXHdB/45msKO2cnj56nwIa5TToN+xqdnYbQzdtuWGDyCOnY2bXfIsSn1LZmlDKO9UPk75P4ystVxgozuEzfykG5Xlu3gL+eME+Kau4FlbFtapwU2KPIHmxSeaAr3dceamnNsrLbd8Bhza1z9d8K4xfF5PjNjsxDgoPAmgSrw1dw6phyT2c7MiUrkEOHwu2LZMQApZwBSyTaFd2mOYiXyZuWb7EOqUboazQIwsOaxDPdsRpVaKreeHmcERd7pofUlRDWtKjN6kkrSh/LQmxrKoFtVx/bIvbuRUgDKnyaLImkgtOqhouFGHWI70Wmqqr5awIsNTYKgOqaJxF2CFSz90ovfltobOgYo7AvFu+eUU=

  distributions: sdist
  skip_existing: true
  on:
    tags: on
