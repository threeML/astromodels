

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extended source tutorial &mdash; Astromodels latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=ad0ac74c" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=c6e86fd7"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
      <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multi-component sources" href="Multi_component_sources.html" />
    <link rel="prev" title="Point sources" href="Point_source_tutorial.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Astromodels
              <img src="../_static/transp_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Quick_start.html">Quick start</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="function_list.html">Available Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Functions_tutorial.html">Functions tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Point_source_tutorial.html">Point sources</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extended source tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Available-shapes">Available shapes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#%22Moveable%22-Functions">“Moveable” Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fixed-position-Functions">Fixed-position Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#%22Calling%22-extended-sources">“Calling” extended sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Caveats-and-gotchas">Caveats and gotchas</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Large-extended-sources">Large extended sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Small-extended-sources">Small extended sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Source-support">Source support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Energy-Dependent-Morphology">Energy-Dependent Morphology</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Multi_component_sources.html">Multi-component sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="Model_tutorial.html">Model tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="Priors_for_Bayesian_analysis.html">Priors for Bayesian analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Additional_features_for_scripts_and_applications.html">Additional features for scripts and applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/API.html#astromodels">astromodels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/API.html#astromodels-package">astromodels package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Astromodels</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Extended source tutorial</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Extended-source-tutorial">
<h1>Extended source tutorial<a class="headerlink" href="#Extended-source-tutorial" title="Link to this heading"></a></h1>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Link to this heading"></a></h2>
<p>Extended sources with constant (not energy-dependent) morphology can be instanced by providing a spectral shape (1D function) and a spatial shape (2D function):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">astromodels</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
<span class="n">disk_source</span> <span class="o">=</span> <span class="n">ExtendedSource</span><span class="p">(</span><span class="s1">&#39;simple_source&#39;</span><span class="p">,</span> <span class="n">spectral_shape</span><span class="o">=</span><span class="n">Powerlaw</span><span class="p">(),</span> <span class="n">spatial_shape</span> <span class="o">=</span> <span class="n">Disk_on_sphere</span><span class="p">()</span> <span class="p">)</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #00ff00; text-decoration-color: #00ff00">18:58:19 </span><span style="color: #af5fd7; text-decoration-color: #af5fd7">WARNING </span> <span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold"> The naima package is not available. Models that depend on it will not be         </span><a href="file:///Users/runner/work/astromodels/astromodels/astromodels/functions/functions_1D/functions.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">functions.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///Users/runner/work/astromodels/astromodels/astromodels/functions/functions_1D/functions.py#47" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">47</span></a>
<span style="color: #00ff00; text-decoration-color: #00ff00">         </span>         <span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold">available                                                                         </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">               </span>
</pre></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #00ff00; text-decoration-color: #00ff00">         </span><span style="color: #af5fd7; text-decoration-color: #af5fd7">WARNING </span> <span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold"> The GSL library or the pygsl wrapper cannot be loaded. Models that depend on it  </span><a href="file:///Users/runner/work/astromodels/astromodels/astromodels/functions/functions_1D/functions.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">functions.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///Users/runner/work/astromodels/astromodels/astromodels/functions/functions_1D/functions.py#68" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">68</span></a>
<span style="color: #00ff00; text-decoration-color: #00ff00">         </span>         <span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold">will not be available.                                                            </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">               </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<ul>

<li>simple_source (extended source):
<ul>

<li>shape:
<ul>

<li>lon0:
<ul>

<li>value: 0.0</li>

<li>desc: Longitude of the center of the source</li>

<li>min_value: 0.0</li>

<li>max_value: 360.0</li>

<li>unit: deg</li>

<li>is_normalization: False</li>

</ul>

</li>

<li>lat0:
<ul>

<li>value: 0.0</li>

<li>desc: Latitude of the center of the source</li>

<li>min_value: -90.0</li>

<li>max_value: 90.0</li>

<li>unit: deg</li>

<li>is_normalization: False</li>

</ul>

</li>

<li>radius:
<ul>

<li>value: 15.0</li>

<li>desc: Radius of the disk</li>

<li>min_value: 0.0</li>

<li>max_value: 20.0</li>

<li>unit: deg</li>

<li>is_normalization: False</li>

</ul>

</li>

</ul>

</li>

<li>spectrum:
<ul>

<li>main:
<ul>

<li>Powerlaw:
<ul>

<li>K:
<ul>

<li>value: 1.0</li>

<li>desc: Normalization (differential flux at the pivot value)</li>

<li>min_value: 1e-30</li>

<li>max_value: 1000.0</li>

<li>unit: keV-1 s-1 cm-2</li>

<li>is_normalization: True</li>

</ul>

</li>

<li>piv:
<ul>

<li>value: 1.0</li>

<li>desc: Pivot value</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: keV</li>

<li>is_normalization: False</li>

</ul>

</li>

<li>index:
<ul>

<li>value: -2.01</li>

<li>desc: Photon index</li>

<li>min_value: -10.0</li>

<li>max_value: 10.0</li>

<li>unit: </li>

<li>is_normalization: False</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul>

</li>

</ul></div>
</div>
<p>Instead of the <code class="docutils literal notranslate"><span class="pre">position</span></code> property, extended sources have a <code class="docutils literal notranslate"><span class="pre">spatial_shape</span></code> property, which contains the function that was specified as the <code class="docutils literal notranslate"><span class="pre">shape</span></code> argument earlier. Information can be printed either with the regular <code class="docutils literal notranslate"><span class="pre">print</span></code> function or using <code class="docutils literal notranslate"><span class="pre">.display()</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Class&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="p">)</span> <span class="p">)</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Name Disk_on_sphere
Class &lt;class &#39;astromodels.functions.functions_2D.Disk_on_sphere&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<ul>

<li>description: A bidimensional disk/tophat function on a sphere (in spherical coordinates)</li>

<li>formula: $$ f(\vec{x}) = \left(\frac{180}{\pi}\right)^2 \frac{1}{\pi~({\rm radius})^2} ~\left\{\begin{matrix} 1 & {\rm if}& {\rm | \vec{x} - \vec{x}_0| \le {\rm radius}} \\ 0 & {\rm if}& {\rm | \vec{x} - \vec{x}_0| > {\rm radius}} \end{matrix}\right. $$</li>

<li>parameters:
<ul>

<li>lon0:
<ul>

<li>value: 0.0</li>

<li>desc: Longitude of the center of the source</li>

<li>min_value: 0.0</li>

<li>max_value: 360.0</li>

<li>unit: deg</li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: True</li>

</ul>

</li>

<li>lat0:
<ul>

<li>value: 0.0</li>

<li>desc: Latitude of the center of the source</li>

<li>min_value: -90.0</li>

<li>max_value: 90.0</li>

<li>unit: deg</li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: True</li>

</ul>

</li>

<li>radius:
<ul>

<li>value: 15.0</li>

<li>desc: Radius of the disk</li>

<li>min_value: 0.0</li>

<li>max_value: 20.0</li>

<li>unit: deg</li>

<li>is_normalization: False</li>

<li>delta: 1.5</li>

<li>free: True</li>

</ul>

</li>

</ul>

</li>

</ul></div>
</div>
<p>Spatial shape parameters can be listed, accessed, changed as any function parameters, for example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
odict_keys([&#39;lon0&#39;, &#39;lat0&#39;, &#39;radius&#39;])
odict_keys([&#39;simple_source.spectrum.main.Powerlaw.K&#39;, &#39;simple_source.spectrum.main.Powerlaw.piv&#39;, &#39;simple_source.spectrum.main.Powerlaw.index&#39;, &#39;simple_source.Disk_on_sphere.lon0&#39;, &#39;simple_source.Disk_on_sphere.lat0&#39;, &#39;simple_source.Disk_on_sphere.radius&#39;])
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
Parameter radius = 15.0 [deg]
(min_value = 0.0, max_value = 20.0, delta = 1.5, free = True)</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
Parameter radius = 0.3 [deg]
(min_value = 0.1, max_value = 1.0, delta = 1.5, free = True)</div>
</div>
</section>
<section id="Available-shapes">
<h2>Available shapes<a class="headerlink" href="#Available-shapes" title="Link to this heading"></a></h2>
<p>Here’s a list of available 2D functions:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">functions</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="n">Function2D</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;Latitude_galactic_diffuse&#39;, &#39;Gaussian_on_sphere&#39;, &#39;Asymm_Gaussian_on_sphere&#39;, &#39;Disk_on_sphere&#39;, &#39;Ellipse_on_sphere&#39;, &#39;SpatialTemplate_2D&#39;, &#39;Power_law_on_sphere&#39;]
</pre></div></div>
</div>
<p>Check the API or use the <code class="docutils literal notranslate"><span class="pre">display()</span></code> function to find out more about the shapes and their free parameters.</p>
<section id="%22Moveable%22-Functions">
<h3>“Moveable” Functions<a class="headerlink" href="#%22Moveable%22-Functions" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Gaussian_on_sphere</span></code>, <code class="docutils literal notranslate"><span class="pre">Asymm_Gaussian_on_sphere</span></code>, <code class="docutils literal notranslate"><span class="pre">Disk_on_sphere</span></code>, <code class="docutils literal notranslate"><span class="pre">Ellipse_on_sphere</span></code>, and <code class="docutils literal notranslate"><span class="pre">Power_law_on_sphere</span></code> each have parameters called <code class="docutils literal notranslate"><span class="pre">lat0</span></code> and <code class="docutils literal notranslate"><span class="pre">lon0</span></code>, describing the longitude (R.A.) and latitude (Declination) of the function’s “center” (center of mass/center of symmetry). These parameters can be set free to allow the source position to vary during the fit, or fixed to a known position. <strong>If fitting the source position, it is strongly recommended to restrict these
parameters so that source overlaps the region of interest (ROI) at all times.</strong> The source moving far enough from the ROI during the fit can lead to issues such as the minimizer getting “stuck” due to the likelihood surface being flat.</p>
<p>Each of these functions also has other parameter(s) related to the source’s extend and (if applicable) its orientation.</p>
<p>All of these functions are normalized so that their integral is 1. The 1D <code class="docutils literal notranslate"><span class="pre">spectrum</span></code> function of an extended source can thus be interpreted as the spectrum that would be observed by a non-imaging instrument with a field of view much larger than the source in question.</p>
</section>
<section id="Fixed-position-Functions">
<h3>Fixed-position Functions<a class="headerlink" href="#Fixed-position-Functions" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Latitude_galactic_diffuse</span></code> and <code class="docutils literal notranslate"><span class="pre">SpatialTemplate_2D</span></code> do not have parameters named <code class="docutils literal notranslate"><span class="pre">lat0</span></code> and <code class="docutils literal notranslate"><span class="pre">lon0</span></code>. Their positions are always fixed throughout the fit.</p>
<p><code class="docutils literal notranslate"><span class="pre">Latitude_galactic_diffuse</span></code> is a function that is constant in Galactic longitude between <code class="docutils literal notranslate"><span class="pre">l_min</span></code> and <code class="docutils literal notranslate"><span class="pre">l_max</span></code> and follows a Gaussian shape in Galactic latitude, with a “width” parameter (<code class="docutils literal notranslate"><span class="pre">sigma_b</span></code>).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span> <span class="o">=</span> <span class="n">Latitude_galactic_diffuse</span><span class="p">()</span>
<span class="n">diff</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<ul>

<li>description: A Gaussian distribution in Galactic latitude around the Galactic plane</li>

<li>formula: $ K \exp{\left( \frac{-b^2}{2 \sigma_b^2} \right)} $</li>

<li>parameters:
<ul>

<li>K:
<ul>

<li>value: 1.0</li>

<li>desc: normalization</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: True</li>

</ul>

</li>

<li>sigma_b:
<ul>

<li>value: 1.0</li>

<li>desc: Sigma for</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: True</li>

</ul>

</li>

<li>l_min:
<ul>

<li>value: 10.0</li>

<li>desc: min Longtitude</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 1.0</li>

<li>free: True</li>

</ul>

</li>

<li>l_max:
<ul>

<li>value: 30.0</li>

<li>desc: max Longtitude</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 3.0</li>

<li>free: True</li>

</ul>

</li>

</ul>

</li>

</ul></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SpatialTemplate_2D</span></code> is designed to read in a user-provided fits file with an image (in WCS coordinates) using the <code class="docutils literal notranslate"><span class="pre">load_file()</span></code> function. The function value will be 0 outside the WCS and equal to the value of the pixel containing the given coordinates inside the WCS. The provided template should be in units of 1/deg2 and normalized so that its integral is 1. If that is not the case, the normalization parameter <code class="docutils literal notranslate"><span class="pre">K</span></code> may be set accordingly so that the overall function is normalized as
expected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="n">temp</span> <span class="o">=</span> <span class="n">SpatialTemplate_2D</span><span class="p">(</span><span class="n">fits_file</span><span class="o">=</span><span class="s1">&#39;spitzer_example_image.fits&#39;</span><span class="p">)</span>
<span class="n">temp</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #00ff00; text-decoration-color: #00ff00">18:58:20 </span><span style="color: #af5fd7; text-decoration-color: #af5fd7">WARNING </span> <span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold"> 2D template read from spitzer_example_image.fits is normalized to nan        </span><a href="file:///Users/runner/work/astromodels/astromodels/astromodels/functions/functions_2D.py" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">functions_2D.py</span></a><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">:</span><a href="file:///Users/runner/work/astromodels/astromodels/astromodels/functions/functions_2D.py#747" target="_blank"><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">747</span></a>
<span style="color: #00ff00; text-decoration-color: #00ff00">         </span>         <span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold">(expected: </span><span style="color: #c0c0c0; text-decoration-color: #c0c0c0; font-weight: bold">1</span><span style="color: #c6c6c6; text-decoration-color: #c6c6c6; font-weight: bold">)                                                                 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">                   </span>
</pre></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<ul>

<li>description: User input Spatial Template.  Expected to be normalized to 1/sr</li>

<li>formula: $ hi $</li>

<li>parameters:
<ul>

<li>K:
<ul>

<li>value: 1.0</li>

<li>desc: normalization</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: False</li>

</ul>

</li>

<li>hash:
<ul>

<li>value: 7.428580553431191e+66</li>

<li>desc: hash of model map [needed for memoization]</li>

<li>min_value: None</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: False</li>

</ul>

</li>

<li>ihdu:
<ul>

<li>value: 0.0</li>

<li>desc: header unit index of fits file</li>

<li>min_value: 0.0</li>

<li>max_value: None</li>

<li>unit: </li>

<li>is_normalization: False</li>

<li>delta: 0.1</li>

<li>free: False</li>

</ul>

</li>

<li>fits_file:
<ul>

<li>value: spitzer_example_image.fits</li>

<li>desc: fits file to load</li>

<li>allowed values: None</li>

<li>defer: True</li>

<li>function: _load_file</li>

</ul>

</li>

<li>frame:
<ul>

<li>value: icrs</li>

<li>desc: coordinate frame</li>

<li>allowed values: ['icrs', 'galactic', 'fk5', 'fk4', 'fk4_no_e']</li>

<li>defer: False</li>

<li>function: None</li>

</ul>

</li>

</ul>

</li>

</ul></div>
</div>
</section>
</section>
<section id="%22Calling%22-extended-sources">
<h2>“Calling” extended sources<a class="headerlink" href="#%22Calling%22-extended-sources" title="Link to this heading"></a></h2>
<p>Extended sources can be called as functions. They take 3 arguments: A list or <code class="docutils literal notranslate"><span class="pre">np.array</span></code> of right ascensions, a list of declinations, and a list of energies. The first two lists must have the same dimensions. The result contains the value(s) of the double differential flux dN/dE/dOmega at all combinations of coordinates and energies. See the example below. There, we picked two positions (one at the center of the disk source, one outside of it) and three energy values. <strong>If no units are
provided, energies are assumed to be in keV, coordinates in degrees, and fluxes are returned in 1/(cm2 keV s deg2).</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">ra_center</span><span class="p">,</span> <span class="n">dec_center</span> <span class="o">=</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">lon0</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">lat0</span><span class="o">.</span><span class="n">value</span>

<span class="n">ra</span> <span class="o">=</span> <span class="p">[</span><span class="n">ra_center</span><span class="p">,</span> <span class="n">ra_center</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">dec</span> <span class="o">=</span> <span class="p">[</span><span class="n">dec_center</span><span class="p">,</span> <span class="n">dec_center</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>

<span class="n">E</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span>

<span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;Whole source:&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">disk_source</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span> <span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Spatial only:&quot;</span> <span class="p">)</span>
<span class="n">spatial</span> <span class="o">=</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">spatial</span> <span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Spectral only:&quot;</span><span class="p">)</span>
<span class="n">spectral</span> <span class="o">=</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">get_total_spatial_integral</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span> <span class="o">*</span> <span class="n">disk_source</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span> <span class="n">spectral</span> <span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span> <span class="s2">&quot;Spatial transposed times spectral&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">spatial</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">spectral</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Whole source:
[[1.16105524e+04 1.13462640e+02 1.10879915e+00]
 [0.00000000e+00 0.00000000e+00 0.00000000e+00]] 1 / (keV s cm2 deg2)

Spatial only:
[11610.55239595     0.        ] 1 / deg2

Spectral only:
[1.00000000e+00 9.77237221e-03 9.54992586e-05] 1 / (keV s cm2)

Spatial transposed times spectral
[[1.16105524e+04 1.13462640e+02 1.10879915e+00]
 [0.00000000e+00 0.00000000e+00 0.00000000e+00]] 1 / (keV s cm2 deg2)
</pre></div></div>
</div>
</section>
<section id="Caveats-and-gotchas">
<h2>Caveats and gotchas<a class="headerlink" href="#Caveats-and-gotchas" title="Link to this heading"></a></h2>
<section id="Large-extended-sources">
<h3>Large extended sources<a class="headerlink" href="#Large-extended-sources" title="Link to this heading"></a></h3>
<p>The Gaussian shapes provided here (<code class="docutils literal notranslate"><span class="pre">Gaussian_on_sphere</span></code>, <code class="docutils literal notranslate"><span class="pre">Asymm_Gaussian_on_sphere</span></code>) are only valid as long as their width (<code class="docutils literal notranslate"><span class="pre">sigma</span></code>/<code class="docutils literal notranslate"><span class="pre">a</span></code> parameter) is much smaller than 360˚. For very large extended sources, we would need to implement the <a class="reference external" href="https://en.wikipedia.org/wiki/Kent_distribution">Kent distribution</a>, the equivalent of a Gaussian on the sphere.</p>
</section>
<section id="Small-extended-sources">
<h3>Small extended sources<a class="headerlink" href="#Small-extended-sources" title="Link to this heading"></a></h3>
<p>Most threeML plugins supporting imaging instruments perform a convolution of the <code class="docutils literal notranslate"><span class="pre">astromodels</span></code> source(s) with the instrument’s point spread function (PSF). These convolutions are typically performed on a grid, and features in the source morphology smaller than the grid size are lost. One should take care that the extent of the source(s) in the model is constrained to be no smaller than the grid spacing used by the plugin.</p>
</section>
<section id="Source-support">
<h3>Source support<a class="headerlink" href="#Source-support" title="Link to this heading"></a></h3>
<p>Each 2D function class has a member function called <code class="docutils literal notranslate"><span class="pre">get_boundaries</span></code>, which returns the (minimal) range in RA and Dec over which the convolution with the PSF has to be computed (see example below). The exact calculation depends on the function but the range typically depends on the centroid and the <strong>maximum value of the width/radius parameter</strong>. That means that even if the radius or gaussian width parameter is fixed during the fit, it is helpful to set a maximum that is close to the fixed
value. This reduces computation time during the likelihood fit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">lon0</span> <span class="o">=</span> <span class="mi">80</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">lat0</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">radius</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>
<span class="n">bounds</span> <span class="o">=</span>  <span class="p">(</span><span class="n">disk_source</span><span class="o">.</span><span class="n">spatial_shape</span><span class="o">.</span><span class="n">get_boundaries</span><span class="p">()</span> <span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;RA range:&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Dec range:&quot;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
RA range: (75.62145488597581, 84.37854511402419)
Dec range: (16.0, 24.0)
</pre></div></div>
</div>
</section>
</section>
<section id="Energy-Dependent-Morphology">
<h2>Energy-Dependent Morphology<a class="headerlink" href="#Energy-Dependent-Morphology" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">astromodels</span></code> functions support energy-dependent morphology in two different ways.</p>
<ol class="arabic simple">
<li><p>Extended sources can be instanced with a 3D function spatial shape and a separate energy spectrum. In that case, the 3D function is expected to be a function of RA, Dec, Energy (in that order) and have units of 1/deg2. The double-differential flux dN/dE/dOmega is again given by the product of the spatial and spectral parts. See for example <code class="docutils literal notranslate"><span class="pre">`Continuous_injection_diffusion</span></code> &lt;<a class="reference external" href="https:link">https:link</a>&gt;`__.</p></li>
<li><p>Extended sources can be instanced with just a 3D function and no energy spectrum. In that case, the 3D function is interpreted as the double-differential flux dN/dE/dOmega.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Point_source_tutorial.html" class="btn btn-neutral float-left" title="Point sources" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Multi_component_sources.html" class="btn btn-neutral float-right" title="Multi-component sources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016--2022, G.Vianello, J. M. Burgess, N. Di Lalla, N. Omodei, H. Fleischhack.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>